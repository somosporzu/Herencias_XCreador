import { useState } from 'react';

export default function HeritageCreator() {
  const [name, setName] = useState('');
  const [nature, setNature] = useState('');
  const [description, setDescription] = useState('');
  const [selectedTraits, setSelectedTraits] = useState([]);
  const [notification, setNotification] = useState(null);
  const [expanded, setExpanded] = useState({});

  const toggleSection = (key) => {
    setExpanded(prev => ({ ...prev, [key]: !prev[key] }));
  };

  const traits = {
    ventajas: {
      mayor: [
        { name: 'Aliento Elemental', cost: 3, desc: '1/d√≠a, infligen 1d6 de da√±o elemental en un √°rea c√≥nica de 3 metros (Salvaci√≥n de Destreza ND 12 para mitad de da√±o)' },
        { name: 'Brazos Adicionales', cost: 3, desc: 'Tienen dos brazos extra m√°s peque√±os. Pueden sostener objetos pero no atacar con ellos' },
        { name: 'Coraz√≥n Secundario', cost: 3, desc: 'Tienen redundancia org√°nica. La primera vez que caen a 0 de Resistencia, se quedan a 1' },
        { name: 'Cuerpo Elemental', cost: 3, desc: 'Parte de su cuerpo es de un elemento (ej: brazo de piedra), otorg√°ndoles un arma natural potente y Resistencia a un tipo de da√±o' },
        { name: 'Gl√°ndulas de Seda', cost: 3, desc: 'Pueden secretar seda resistente para crear cuerdas (10 m/d√≠a) o redes peque√±as' },
        { name: 'Inmunidad a Enfermedades', cost: 3, desc: 'Son inmunes a todas las enfermedades no m√°gicas' },
        { name: 'Mente Telep√°tica', cost: 3, desc: 'Pueden comunicarse mentalmente con criaturas a 10 metros' },
        { name: 'No Necesitan Dormir', cost: 3, desc: 'Solo necesitan 4 horas de meditaci√≥n o trance para obtener los beneficios de un descanso largo' },
        { name: 'Piel Camale√≥nica', cost: 3, desc: 'Tienen ventaja en todas las tiradas de sigilo para esconderse' },
        { name: 'Piel de Piedra', cost: 3, desc: 'Ignoran 1 punto de da√±o de cualquier fuente' },
        { name: 'Regeneraci√≥n Leve', cost: 3, desc: 'Recuperan 3 de Resistencia al final de cada combate' },
        { name: 'Regeneraci√≥n de Miembros', cost: 3, desc: 'Sus cuerpos pueden regenerar extremidades perdidas completamente tras 1d6 d√≠as de descanso' },
        { name: 'Sentido Ciego', cost: 3, desc: 'Pueden "ver" sin usar los ojos en un radio de 5 m. Son inmunes a la ceguera' },
        { name: 'Toque Paralizante', cost: 3, desc: '1/d√≠a, su ataque desarmado puede paralizar al objetivo si falla una Salvaci√≥n de Constituci√≥n (ND 12)' },
        { name: 'Toque Vamp√≠rico Menor', cost: 3, desc: '1/d√≠a, al infligir da√±o con un ataque cuerpo a cuerpo, pueden recuperar una cantidad de Resistencia igual a la mitad del da√±o infligido' },
        { name: 'Visi√≥n en la Oscuridad Superior', cost: 3, desc: 'Pueden ver en la oscuridad total como si fuera de d√≠a, percibiendo todos los colores' },
        { name: 'Vuelo Limitado', cost: 3, desc: 'Pueden planear o volar cortas distancias (su movimiento de vuelo es igual a su velocidad terrestre, pero caen si terminan su turno en el aire)' }
      ],
      medio: [
        { name: 'Acr√≥batas Natos', cost: 2, desc: 'Tienen ventaja en las tiradas de acrobacias y equilibrio' },
        { name: 'Adherencia Mural', cost: 2, desc: 'Pueden trepar superficies verticales dif√≠ciles, incluso techos, sin necesidad de tiradas' },
        { name: 'Afinidad con una Fuerza', cost: 2, desc: 'El coste en PX para comprar t√©cnicas de una Fuerza espec√≠fica se reduce en un 10%' },
        { name: 'Afinidad Elemental Menor', cost: 2, desc: 'Pueden realizar peque√±os trucos con un elemento (encender una vela, enfriar una bebida)' },
        { name: 'Arma Natural Potente', cost: 2, desc: 'Garras o cuernos que infligen 1d6 de da√±o' },
        { name: 'Caparaz√≥n Dorsal', cost: 2, desc: 'Una placa dura protege sus espaldas. Los ataques por la retaguardia no tienen ventaja contra ellos' },
        { name: 'Defensa Natural', cost: 2, desc: '+1 estable a la Defensa' },
        { name: 'Ecolocalizaci√≥n', cost: 2, desc: 'Pueden emitir sonidos inaudibles para "ver" su entorno en un radio de 10 m. Funciona en oscuridad total pero no en silencio m√°gico' },
        { name: 'Empat√≠a Animal', cost: 2, desc: 'Pueden comunicarse de forma simple y emp√°tica con los animales' },
        { name: 'Espinas Retr√°ctiles', cost: 2, desc: 'Cuerpos cubiertos de espinas ocultas. Quien intente agarrarlos sufre 1d6-2 de da√±o autom√°ticamente' },
        { name: 'Est√≥mago Carro√±ero', cost: 2, desc: 'Su biolog√≠a les permite comer carne podrida o cruda sin enfermar, y les nutre como comida fresca' },
        { name: 'Exoesqueletos', cost: 2, desc: 'Sus cuerpos est√°n cubiertos de placas quitinosas. Ganan +2 a la Defensa pero no pueden llevar armadura' },
        { name: 'Feromonas', cost: 2, desc: 'Tienen ventaja en las tiradas sociales para persuadir o atraer a otros' },
        { name: 'Fotos√≠ntesis', cost: 2, desc: 'Si pasan al menos 4 horas bajo la luz solar, no necesitan comer ese d√≠a' },
        { name: 'Garras Retr√°ctiles', cost: 2, desc: 'Poseen garras retr√°ctiles que infligen 1d6-3 de da√±o y que pueden ocultar a voluntad' },
        { name: 'Membranas Interdigitales', cost: 2, desc: 'Nadan a su velocidad normal de tierra y tienen ventaja en agarres bajo el agua' },
        { name: 'Memoria Prodigiosa', cost: 2, desc: 'Recuerdan con cierta facilidad todo lo que ven o leen. Ventaja en tiradas que impliquen recordar' },
        { name: 'Metabolismo Eficiente', cost: 2, desc: 'Solo necesitan la mitad de comida y agua para evitar la fatiga' },
        { name: 'Miembros El√°sticos', cost: 2, desc: 'Pueden estirar sus brazos hasta el doble de su longitud, aumentando su alcance' },
        { name: 'Movimiento Especial', cost: 2, desc: 'Ganan una velocidad de trepar o nadar igual a su velocidad terrestre' },
        { name: 'Naturaleza Adicional', cost: 2, desc: 'Ganan una Naturaleza extra a su elecci√≥n' },
        { name: 'Paso Ligero Avanzado', cost: 2, desc: 'Pueden moverse sobre superficies como nieve profunda o barro sin penalizaci√≥n' },
        { name: 'Resistencia a Venenos', cost: 2, desc: 'Tienen ventaja en las Tiradas de Salvaci√≥n contra venenos' },
        { name: 'Resistencia Aumentada', cost: 2, desc: '+5 a su Resistencia m√°xima' },
        { name: 'Resistencia M√°gica', cost: 2, desc: 'Tienen ventaja en las salvaciones contra los efectos de T√©cnicas' },
        { name: 'Saliva Corrosiva', cost: 2, desc: 'Pueden escupir √°cido (1d6 de da√±o) a corta distancia como acci√≥n' },
        { name: 'Sentidos Agudos', cost: 2, desc: 'Ventaja en todas las tiradas de un sentido (o√≠do, olfato)' },
        { name: 'Visi√≥n en la Oscuridad', cost: 2, desc: 'Pueden ver en la oscuridad total como si hubiera penumbra, pero en blanco y negro' }
      ],
      menor: [
        { name: 'Armas Naturales D√©biles', cost: 1, desc: 'Garras o colmillos que infligen 1d6-3 de da√±o' },
        { name: 'Bioluminiscencia', cost: 1, desc: 'Pueden emitir luz tenue desde sus cuerpos a voluntad. Tienen desventaja en sigilo en la oscuridad' },
        { name: 'Bolsas en la Mejilla', cost: 1, desc: 'Poseen espacio biol√≥gico expansible en la boca para guardar objetos peque√±os ocultos' },
        { name: 'Bono de Habilidad Menor', cost: 1, desc: '+1 a una tirada muy espec√≠fica (ej: trepar, nadar)' },
        { name: 'Colas Prensiles', cost: 1, desc: 'Pueden usar sus colas para sostener objetos peque√±os (no armas)' },
        { name: 'Duros de Cabeza', cost: 1, desc: '+1 a las tiradas para resistir la intimidaci√≥n' },
        { name: 'Equilibrio Perfecto', cost: 1, desc: 'Tienen ventaja en las tiradas para evitar caerse o ser derribados' },
        { name: 'Est√≥magos de Hierro', cost: 1, desc: 'Tienen ventaja en las salvaciones contra enfermedades por comida' },
        { name: 'Familiaridad Animal', cost: 1, desc: '+1 a las tiradas para interactuar con un tipo de animal (lobos, aves, etc.)' },
        { name: 'Fisiolog√≠a Anfibia', cost: 1, desc: 'Pueden respirar tanto en aire como en agua' },
        { name: 'Manos H√°biles', cost: 1, desc: '+1 a las tiradas de artesan√≠a fina (joyer√≠a, relojer√≠a, etc.)' },
        { name: 'Orientaci√≥n Natural', cost: 1, desc: 'Tienen ventaja en las tiradas para no perderse en la naturaleza' },
        { name: 'P√°rpados Nictitantes', cost: 1, desc: 'Membranas transparentes que protegen sus ojos. Son inmunes a la ceguera por arena o polvo' },
        { name: 'Pelo Aislante', cost: 1, desc: 'Su pelaje les otorga ventaja en salvaciones naturales contra el fr√≠o extremo' },
        { name: 'Percepci√≥n Aguda', cost: 1, desc: '+1 a las tiradas para notar detalles sutiles' },
        { name: 'Piel de Piedra Menor', cost: 1, desc: 'Ignoran 1 punto de da√±o de un tipo espec√≠fico (ej: Contundente, Cortante, Fuego)' },
        { name: 'Pies Ligeros', cost: 1, desc: 'Ignoran el terreno dif√≠cil causado por vegetaci√≥n o suelo irregular' },
        { name: 'Pulmones Grandes', cost: 1, desc: 'Pueden aguantar la respiraci√≥n el doble de tiempo' },
        { name: 'Resistencia al Dolor', cost: 1, desc: 'Obtienen ventaja en las tiradas relacionadas con soportar el dolor' },
        { name: 'Resistencia Clim√°tica', cost: 1, desc: 'Resisten mejor un clima espec√≠fico (fr√≠o o calor)' },
        { name: 'Voz M√≠mica', cost: 1, desc: 'Sus siringes les permiten imitar sonidos de animales simples con gran precisi√≥n' },
        { name: 'Voz Resonante', cost: 1, desc: 'Tienen ventaja en tiradas para hacerse o√≠r a distancia o en multitudes' }
      ]
    },
    desventajas: {
      menor: [
        { name: 'Alergia Com√∫n', cost: -1, desc: 'La herencia es al√©rgico a algo com√∫n (polen, polvo, un tipo de animal)' },
        { name: 'Condicionado', cost: -1, desc: 'Una de sus ventajas solo funciona en una situaci√≥n o momento espec√≠fico' },
        { name: 'Curiosidad M√≥rbida', cost: -1, desc: 'Deben superar una tirada de Aura (ND 9) para no investigar algo obviamente peligroso' },
        { name: 'Dieta Especial', cost: -1, desc: 'Al menos una vez cada tres d√≠as deben alimentarse de un tipo muy espec√≠fico de comida' },
        { name: 'Dientes de Crecimiento', cost: -1, desc: 'Sus dientes nunca dejan de crecer. Deben roer objetos duros diariamente o sufrir dolor' },
        { name: 'Fobia Com√∫n', cost: -1, desc: 'Tienen una fobia a algo com√∫n (insectos, alturas, espacios cerrados)' },
        { name: 'Huesos Fr√°giles', cost: -1, desc: 'Reciben el doble de da√±o de las ca√≠das' },
        { name: 'Mala Memoria', cost: -1, desc: 'Tienen desventaja para recordar detalles, nombres o hechos hist√≥ricos' },
        { name: 'Miedo Instintivo', cost: -1, desc: 'Deben superar una tirada de Aura para no asustarse ante un animal o fen√≥meno com√∫n' },
        { name: 'Muda de Piel', cost: -1, desc: 'Peri√≥dicamente pierden su capa externa, quedando vulnerable (-1 Defensa) por un d√≠a' },
        { name: 'Necesidad F√≠sica Leve', cost: -1, desc: 'Requieren m√°s agua, comida o descanso de lo normal' },
        { name: 'Olor Distintivo', cost: -1, desc: 'Tienen desventaja en sigilo contra criaturas con buen olfato' },
        { name: 'Piel Sensible', cost: -1, desc: 'Reciben +1 de da√±o de Fuego o Hielo' },
        { name: 'Sabor Agradable', cost: -1, desc: 'Las bestias prefieren atacarlos antes que a otros' },
        { name: 'Sangre Fr√≠a', cost: -1, desc: 'Sufren un -1 a todas las tiradas en climas fr√≠os y no recuperan fatiga mientras est√©n en un clima fr√≠o' },
        { name: 'Sin Sentido de la Orientaci√≥n', cost: -1, desc: 'Tienen desventaja en las tiradas para no perderse' },
        { name: 'Sudoraci√≥n Excesiva', cost: -1, desc: 'Su cuerpo produce exceso de fluidos. Desventaja en agarres y social' },
        { name: 'Sue√±o Profundo', cost: -1, desc: 'Les cuesta despertar. Desventaja en tiradas para despertarse ante ruidos' },
        { name: 'Tics Nerviosos', cost: -1, desc: 'Movimientos involuntarios les dan desventaja en Sigilo al estar quietos' },
        { name: 'Torpeza Espec√≠fica', cost: -1, desc: '-1 a todas las tiradas de una habilidad espec√≠fica' },
        { name: 'Voz D√©bil', cost: -1, desc: 'Tienen desventaja en tiradas para hacerse o√≠r a distancia o en multitudes' },
        { name: 'Vulnerabilidad Clim√°tica', cost: -1, desc: 'Fatiga m√°s r√°pida en un clima espec√≠fico (calor o fr√≠o)' }
      ],
      medio: [
        { name: 'Atributo Reducido', cost: -2, desc: '-1 permanente a un Atributo primario al inicio' },
        { name: 'Conexi√≥n Emp√°tica', cost: -2, desc: 'Sienten el dolor f√≠sico de las criaturas a su alrededor' },
        { name: 'Dieta Especializada', cost: -2, desc: 'Solo pueden alimentarse de un tipo muy espec√≠fico de comida' },
        { name: 'F√≠sico Inusual', cost: -2, desc: 'No pueden usar equipo est√°ndar sin adaptarlo (coste x2)' },
        { name: 'Fragilidad F√≠sica', cost: -2, desc: 'Reciben +1 de da√±o de un tipo espec√≠fico (ej: Contundente)' },
        { name: 'Limitaci√≥n Mental', cost: -2, desc: 'No pueden mentir, entender met√°foras o usar cierto equipo' },
        { name: 'Maldici√≥n Menor', cost: -2, desc: 'Sufren mala suerte en un √°rea espec√≠fica. Sufren desventaja en dicha situaciones' },
        { name: 'Metabolismo Exigente', cost: -2, desc: 'Requieren el doble de alimento y agua para no sufrir Fatiga' },
        { name: 'Piel Absorbente', cost: -2, desc: 'Sus poros absorben sustancias t√≥xicas al tocarlas. Tienen desventaja en salvaciones contra veneno' },
        { name: 'Resistencia Reducida', cost: -2, desc: '-2 a su Resistencia m√°xima inicial' },
        { name: 'Respiraci√≥n Ruidosa', cost: -2, desc: 'Su respiraci√≥n es audible. Penalizador de -2 a Sigilo' },
        { name: 'Rigidez Matutina', cost: -2, desc: '-2 a Destreza durante la primera hora tras despertar' },
        { name: 'Sangre Dulce', cost: -2, desc: 'En combate es m√°s probable que sus enemigos les ataquen por encima de sus aliados' },
        { name: 'Sensible a la Luz Solar', cost: -2, desc: 'Tienen desventaja en acciones bajo luz solar directa' },
        { name: 'Sensible a la Luz Lunar', cost: -2, desc: 'Tienen desventaja en acciones bajo luz Lunar directa' },
        { name: 'Sin Sentido del Olfato', cost: -2, desc: 'Incapaz de percibir olores (desventaja en percepci√≥n olfativa)' },
        { name: 'Sin Sombra', cost: -2, desc: 'No proyectan sombra, lo que genera desconfianza y miedo supersticioso' },
        { name: 'Visi√≥n de Movimiento', cost: -2, desc: 'Desventaja para percibir objetos o criaturas totalmente inm√≥viles' }
      ],
      mayor: [
        { name: 'Anatom√≠a R√≠gida', cost: -3, desc: 'No pueden doblar su torso. Desventaja en acrobacias y cuesta levantarse' },
        { name: 'Atrofia de Brazos', cost: -3, desc: 'Brazos d√©biles. -2 a tiradas de Fuerza y da√±o cuerpo a cuerpo' },
        { name: 'Ceguera', cost: -3, desc: 'No pueden ver. Fallan autom√°ticamente cualquier tirada visual' },
        { name: 'Ceguera Diurna', cost: -3, desc: 'Quedan cegados bajo luz solar brillante o fuentes intensas' },
        { name: 'Debilidad Elemental Mayor', cost: -3, desc: 'Son Vulnerables (doble da√±o) a un tipo de da√±o elemental' },
        { name: 'Defecto F√≠sico Serio', cost: -3, desc: 'Empiezan con una desventaja mec√°nica permanente' },
        { name: 'Dependencia de Agua', cost: -3, desc: 'Deben sumergirse 1 hora al d√≠a o no recuperan PH' },
        { name: 'No Pueden Sanar Naturalmente', cost: -3, desc: 'La recuperaci√≥n por descanso no les afecta. Solo sanan por T√©cnicas' },
        { name: 'Nocturnos Obligados', cost: -3, desc: 'La luz solar directa les causa dolor y desventaja' },
        { name: 'Costumbre', cost: -3, desc: 'Deben cumplir una condici√≥n especial regular o sufrir consecuencias' },
        { name: 'Piel Fotosensible', cost: -3, desc: 'Reciben 1 punto de da√±o por turno bajo luz solar directa' },
        { name: 'Sin Voz', cost: -3, desc: 'No pueden hablar' },
        { name: 'Sistema Inmune Nulo', cost: -3, desc: 'Desventaja contra enfermedades/venenos y doble da√±o de veneno' },
        { name: 'Vulnerables a un Material Com√∫n', cost: -3, desc: 'Doble da√±o de armas hechas de un material com√∫n (hierro, plata, etc.)' }
      ]
    }
  };

  const addTrait = (trait) => {
    setSelectedTraits([...selectedTraits, { ...trait, id: Date.now() }]);
  };

  const removeTrait = (id) => {
    setSelectedTraits(selectedTraits.filter(t => t.id !== id));
  };

  const calculateTotal = () => {
    return selectedTraits.reduce((sum, trait) => sum + trait.cost, 0);
  };

  const isValid = () => {
    const total = calculateTotal();
    const traitCount = selectedTraits.length;
    const hasDisadvantage = selectedTraits.some(t => t.cost < 0);
    return total === 0 && traitCount >= 2 && traitCount <= 7 && hasDisadvantage && name.trim() !== '' && nature.trim() !== '';
  };

  const getValidationStatus = () => {
    const total = calculateTotal();
    const traitCount = selectedTraits.length;
    const hasDisadvantage = selectedTraits.some(t => t.cost < 0);
    
    const issues = [];
    if (total !== 0) issues.push(`Balance: ${total} PH (debe ser 0)`);
    if (traitCount < 2) issues.push(`Rasgos: ${traitCount}/7 (m√≠nimo 2)`);
    if (traitCount > 7) issues.push(`Rasgos: ${traitCount}/7 (m√°ximo 7)`);
    if (!hasDisadvantage) issues.push('Falta desventaja');
    if (!name.trim()) issues.push('Falta nombre');
    if (!nature.trim()) issues.push('Falta naturaleza');
    
    return issues;
  };

  const total = calculateTotal();
  const issues = getValidationStatus();

  return (
    <div className="min-h-screen bg-gradient-to-br from-amber-50 via-green-50 to-amber-100 p-4">
      {notification && (
        <div className="fixed top-4 right-4 bg-green-700 text-white px-6 py-3 rounded-lg shadow-lg z-50">
          {notification}
        </div>
      )}
      
      <div className="max-w-7xl mx-auto">
        <header className="text-center mb-8 pt-6">
          <h1 className="text-5xl font-bold text-green-800 mb-2">Creador de Herencias</h1>
          <p className="text-green-700 text-lg">Sistema modular de puntos (PH)</p>
        </header>

        <div className="grid lg:grid-cols-3 gap-6">
          <div className="lg:col-span-2 space-y-6">
            <div className="bg-white rounded-lg shadow-xl p-6 border-2 border-green-600">
              <h2 className="text-2xl font-bold text-green-800 mb-4">Informaci√≥n B√°sica</h2>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-green-800 mb-2 font-semibold">Nombre de la Herencia *</label>
                  <input
                    type="text"
                    value={name}
                    onChange={(e) => setName(e.target.value)}
                    placeholder="Ej: Draconidos"
                    className="w-full px-4 py-2 bg-amber-50 text-green-900 rounded border-2 border-green-400 focus:border-green-600 outline-none"
                  />
                </div>
                
                <div>
                  <label className="block text-green-800 mb-2 font-semibold">Naturaleza (Gratuita) *</label>
                  <input
                    type="text"
                    value={nature}
                    onChange={(e) => setNature(e.target.value)}
                    placeholder="Ej: Reptiliano, Resistente"
                    className="w-full px-4 py-2 bg-amber-50 text-green-900 rounded border-2 border-green-400 focus:border-green-600 outline-none"
                  />
                  <p className="text-green-600 text-sm mt-1">La Naturaleza no cuenta en el c√°lculo de PH</p>
                </div>
                
                <div>
                  <label className="block text-green-800 mb-2 font-semibold">Descripci√≥n (Opcional)</label>
                  <textarea
                    value={description}
                    onChange={(e) => setDescription(e.target.value)}
                    placeholder="Describe brevemente esta herencia..."
                    rows="3"
                    className="w-full px-4 py-2 bg-amber-50 text-green-900 rounded border-2 border-green-400 focus:border-green-600 outline-none resize-none"
                  />
                </div>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow-xl p-6 border-2 border-green-600">
              <h2 className="text-2xl font-bold text-green-800 mb-4">Biblioteca de Rasgos</h2>
              
              <div className="space-y-6">
                <div>
                  <h3 className="text-xl font-bold text-green-700 mb-3">Ventajas</h3>
                  
                  {Object.entries(traits.ventajas).map(([category, items]) => {
                    const key = `ventaja-${category}`;
                    const isExpanded = expanded[key];
                    const phValue = category === 'mayor' ? '+3' : category === 'medio' ? '+2' : '+1';
                    
                    return (
                      <div key={category} className="mb-3 border-2 border-green-300 rounded-lg overflow-hidden">
                        <button
                          onClick={() => toggleSection(key)}
                          className="w-full p-3 bg-green-100 hover:bg-green-200 transition-colors flex justify-between items-center"
                        >
                          <h4 className="text-lg font-semibold text-red-800 capitalize">
                            {category} ({phValue} PH) - {items.length} rasgos
                          </h4>
                          <span className="text-red-800 text-xl">{isExpanded ? '‚àí' : '+'}</span>
                        </button>
                        
                        {isExpanded && (
                          <div className="p-3 bg-white space-y-2">
                            {items.map((trait, idx) => (
                              <button
                                key={idx}
                                onClick={() => addTrait(trait)}
                                className="w-full text-left p-3 bg-red-50 hover:bg-red-100 rounded border border-red-300 transition-colors"
                              >
                                <div className="flex justify-between items-start">
                                  <div className="flex-1">
                                    <div className="font-semibold text-red-800">{trait.name}</div>
                                    <div className="text-sm text-red-700 mt-1">{trait.desc}</div>
                                  </div>
                                  <span className="text-red-600 ml-2 text-xl">+</span>
                                </div>
                              </button>
                            ))}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>

          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow-xl p-6 border-2 border-green-600 sticky top-4">
              <h2 className="text-2xl font-bold text-green-800 mb-4">Tu Herencia</h2>
              
              <div className="mb-4 p-4 bg-amber-50 rounded border-2 border-green-400">
                <div className="text-center">
                  <div className="text-4xl font-bold mb-2" style={{color: total === 0 ? '#15803d' : '#dc2626'}}>
                    {total} PH
                  </div>
                  <div className="text-green-700 text-sm">Balance Total</div>
                </div>
                
                <div className="mt-4 flex justify-around text-center">
                  <div>
                    <div className="text-2xl font-bold text-green-900">{selectedTraits.length}</div>
                    <div className="text-green-600 text-xs">Rasgos</div>
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-green-600">
                      {selectedTraits.filter(t => t.cost > 0).length}
                    </div>
                    <div className="text-green-600 text-xs">Ventajas</div>
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-red-600">
                      {selectedTraits.filter(t => t.cost < 0).length}
                    </div>
                    <div className="text-green-600 text-xs">Desventajas</div>
                  </div>
                </div>
              </div>

              {issues.length > 0 && (
                <div className="mb-4 p-3 bg-red-100 border-2 border-red-400 rounded">
                  <div className="flex items-start gap-2 mb-2">
                    <span className="text-red-600 mt-1">‚ö†</span>
                    <div>
                      <div className="font-semibold text-red-800">Herencia incompleta:</div>
                      <ul className="text-sm text-red-700 mt-1 space-y-1">
                        {issues.map((issue, i) => (
                          <li key={i}>‚Ä¢ {issue}</li>
                        ))}
                      </ul>
                    </div>
                  </div>
                </div>
              )}

              {isValid() && (
                <div className="mb-4 p-3 bg-green-100 border-2 border-green-500 rounded">
                  <div className="flex items-center gap-2">
                    <span className="text-green-700">‚úì</span>
                    <div className="font-semibold text-green-800">Herencia v√°lida</div>
                  </div>
                </div>
              )}

              <div className="space-y-3 mb-4 max-h-96 overflow-y-auto">
                {selectedTraits.map(trait => (
                  <div key={trait.id} className="p-3 bg-amber-50 rounded border-l-4" style={{borderColor: trait.cost > 0 ? '#15803d' : '#dc2626'}}>
                    <div className="flex justify-between items-start mb-1">
                      <div className="font-semibold text-green-900">{trait.name}</div>
                      <button
                        onClick={() => removeTrait(trait.id)}
                        className="text-red-600 hover:text-red-700 font-bold text-lg"
                      >
                        √ó
                      </button>
                    </div>
                    <div className="text-xs text-green-700">{trait.desc}</div>
                    <div className="text-xs mt-1 font-semibold" style={{color: trait.cost > 0 ? '#15803d' : '#dc2626'}}>
                      {trait.cost > 0 ? '+' : ''}{trait.cost} PH
                    </div>
                  </div>
                ))}
              </div>

              <div className="space-y-2">
                <button
                  disabled={!isValid()}
                  className="w-full py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded font-semibold transition-colors flex items-center justify-center gap-2"
                >
                  <span>üìÑ</span>
                  Exportar como Texto
                </button>
                <button
                  disabled={!isValid()}
                  className="w-full py-3 bg-green-700 hover:bg-green-800 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded font-semibold transition-colors flex items-center justify-center gap-2"
                >
                  <span>üñºÔ∏è</span>
                  Exportar como Imagen
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}4 className="text-lg font-semibold text-green-800 capitalize">
                            {category} ({phValue} PH) - {items.length} rasgos
                          </h4>
                          <span className="text-green-800 text-xl">{isExpanded ? '‚àí' : '+'}</span>
                        </button>
                        
                        {isExpanded && (
                          <div className="p-3 bg-white space-y-2">
                            {items.map((trait, idx) => (
                              <button
                                key={idx}
                                onClick={() => addTrait(trait)}
                                className="w-full text-left p-3 bg-green-50 hover:bg-green-100 rounded border border-green-300 transition-colors"
                              >
                                <div className="flex justify-between items-start">
                                  <div className="flex-1">
                                    <div className="font-semibold text-green-800">{trait.name}</div>
                                    <div className="text-sm text-green-700 mt-1">{trait.desc}</div>
                                  </div>
                                  <span className="text-green-600 ml-2 text-xl">+</span>
                                </div>
                              </button>
                            ))}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>

                <div>
                  <h3 className="text-xl font-bold text-red-700 mb-3">Desventajas</h3>
                  
                  {Object.entries(traits.desventajas).map(([category, items]) => {
                    const key = `desventaja-${category}`;
                    const isExpanded = expanded[key];
                    const phValue = category === 'mayor' ? '-3' : category === 'medio' ? '-2' : '-1';
                    
                    return (
                      <div key={category} className="mb-3 border-2 border-red-300 rounded-lg overflow-hidden">
                        <button
                          onClick={() => toggleSection(key)}
                          className="w-full p-3 bg-red-100 hover:bg-red-200 transition-colors flex justify-between items-center"
                        >
                          <h
